<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Nipat Chenthanakij">

<title>Anomaly detection models to identify anomalous patterns on orders and order volumes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/quarto.js"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="index_files/libs/quarto-html/anchor.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="index_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="index_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="index_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#data-preparation" id="toc-data-preparation" class="nav-link active" data-scroll-target="#data-preparation"><span class="header-section-number">1</span> Data Preparation</a>
  <ul class="collapse">
  <li><a href="#handling-null-values" id="toc-handling-null-values" class="nav-link" data-scroll-target="#handling-null-values"><span class="header-section-number">1.1</span> Handling Null Values</a></li>
  <li><a href="#data-imputation" id="toc-data-imputation" class="nav-link" data-scroll-target="#data-imputation"><span class="header-section-number">1.2</span> Data Imputation</a></li>
  <li><a href="#feature-selection" id="toc-feature-selection" class="nav-link" data-scroll-target="#feature-selection"><span class="header-section-number">1.3</span> Feature Selection</a></li>
  </ul></li>
  <li><a href="#delivery-time-and-cooking-time-anomaly-detection" id="toc-delivery-time-and-cooking-time-anomaly-detection" class="nav-link" data-scroll-target="#delivery-time-and-cooking-time-anomaly-detection"><span class="header-section-number">2</span> Delivery time and cooking time anomaly detection</a>
  <ul class="collapse">
  <li><a href="#delivery-time-anomaly-detection" id="toc-delivery-time-anomaly-detection" class="nav-link" data-scroll-target="#delivery-time-anomaly-detection"><span class="header-section-number">2.1</span> Delivery time anomaly detection</a></li>
  <li><a href="#cooking-time-anomaly-detection" id="toc-cooking-time-anomaly-detection" class="nav-link" data-scroll-target="#cooking-time-anomaly-detection"><span class="header-section-number">2.2</span> Cooking time anomaly detection</a></li>
  </ul></li>
  <li><a href="#order-volume-anomaly-detection" id="toc-order-volume-anomaly-detection" class="nav-link" data-scroll-target="#order-volume-anomaly-detection"><span class="header-section-number">3</span> Order volume anomaly detection</a>
  <ul class="collapse">
  <li><a href="#visualizing-the-order-volumes-across-all-restaurants." id="toc-visualizing-the-order-volumes-across-all-restaurants." class="nav-link" data-scroll-target="#visualizing-the-order-volumes-across-all-restaurants."><span class="header-section-number">3.1</span> Visualizing the order volumes across all restaurants.</a></li>
  <li><a href="#restaurants-with-high-volume" id="toc-restaurants-with-high-volume" class="nav-link" data-scroll-target="#restaurants-with-high-volume"><span class="header-section-number">3.2</span> Restaurants with high volume</a></li>
  <li><a href="#restaurants-with-low-volume" id="toc-restaurants-with-low-volume" class="nav-link" data-scroll-target="#restaurants-with-low-volume"><span class="header-section-number">3.3</span> Restaurants with low volume</a></li>
  <li><a href="#restaurants-with-high-volume-volatility" id="toc-restaurants-with-high-volume-volatility" class="nav-link" data-scroll-target="#restaurants-with-high-volume-volatility"><span class="header-section-number">3.4</span> Restaurants with high volume volatility</a></li>
  <li><a href="#the-anomaly-detection-model" id="toc-the-anomaly-detection-model" class="nav-link" data-scroll-target="#the-anomaly-detection-model"><span class="header-section-number">3.5</span> The Anomaly Detection Model</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Anomaly detection models to identify anomalous patterns on orders and order volumes</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Nipat Chenthanakij </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<p>Task 2: Build anomaly detection models to identify anomalous patterns.</p>
<ul>
<li>Anomalous orders overall (e.g., based on cooking times, delivery times, prices, etc.)</li>
<li>Anomalous restaurants in the future based on order volumes (i.e.&nbsp;restaurants which have sudden changes in order volumes)</li>
</ul>
<section id="data-preparation" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="data-preparation"><span class="header-section-number">1</span> Data Preparation</h2>
<div id="cell-5" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(<span class="st">"./lmwn_case_study_data.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Inspect the dataset columns</p>
<div id="cell-7" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>df.columns.tolist()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre><code>['order_date',
 'order_day_of_week',
 'order_hour',
 'delivery_status',
 'payment_method',
 'coupon_usage',
 'delivery_fee',
 'food_price',
 'cooking_time_in_seconds',
 'delivery_time_in_seconds',
 'restaurant_id',
 'restaurant_category',
 'restaurant_type',
 'province',
 'nb_menu_items']</code></pre>
</div>
</div>
<p>Calculate statistics for numeric columns</p>
<div id="cell-9" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>df.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="5">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">order_date</th>
<th data-quarto-table-cell-role="th">order_hour</th>
<th data-quarto-table-cell-role="th">delivery_fee</th>
<th data-quarto-table-cell-role="th">food_price</th>
<th data-quarto-table-cell-role="th">cooking_time_in_seconds</th>
<th data-quarto-table-cell-role="th">delivery_time_in_seconds</th>
<th data-quarto-table-cell-role="th">restaurant_id</th>
<th data-quarto-table-cell-role="th">nb_menu_items</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>236142.000000</td>
<td>236142.000000</td>
<td>236142.000000</td>
<td>236142.000000</td>
<td>210176.000000</td>
<td>215338.000000</td>
<td>236142.000000</td>
<td>230337.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>212.946994</td>
<td>14.544892</td>
<td>16.205973</td>
<td>196.778639</td>
<td>782.585585</td>
<td>541.573563</td>
<td>98.985221</td>
<td>85.563557</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>106.790041</td>
<td>4.085919</td>
<td>30.912053</td>
<td>206.840366</td>
<td>612.569108</td>
<td>496.373077</td>
<td>52.467492</td>
<td>82.752999</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>1.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>1.000000</td>
<td>1.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>122.000000</td>
<td>11.000000</td>
<td>0.000000</td>
<td>80.000000</td>
<td>468.000000</td>
<td>317.000000</td>
<td>55.000000</td>
<td>34.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>228.000000</td>
<td>14.000000</td>
<td>10.000000</td>
<td>138.000000</td>
<td>681.000000</td>
<td>468.000000</td>
<td>104.000000</td>
<td>61.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>310.000000</td>
<td>18.000000</td>
<td>15.000000</td>
<td>230.000000</td>
<td>980.000000</td>
<td>671.000000</td>
<td>142.000000</td>
<td>106.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>365.000000</td>
<td>23.000000</td>
<td>1182.000000</td>
<td>7001.000000</td>
<td>156541.000000</td>
<td>101097.000000</td>
<td>200.000000</td>
<td>969.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Checking each column for null values</p>
<div id="cell-11" class="cell" data-execution_count="6">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>df.isna().<span class="bu">sum</span>().sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>cooking_time_in_seconds     25966
delivery_time_in_seconds    20804
nb_menu_items                5805
order_date                      0
order_day_of_week               0
order_hour                      0
delivery_status                 0
payment_method                  0
coupon_usage                    0
delivery_fee                    0
food_price                      0
restaurant_id                   0
restaurant_category             0
restaurant_type                 0
province                        0
dtype: int64</code></pre>
</div>
</div>
<section id="handling-null-values" class="level3" data-number="1.1">
<h3 data-number="1.1" class="anchored" data-anchor-id="handling-null-values"><span class="header-section-number">1.1</span> Handling Null Values</h3>
<p>Inspect rows with null delivery time</p>
<div id="cell-13" class="cell" data-execution_count="7">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>df[df[<span class="st">"delivery_time_in_seconds"</span>].isna()].head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="7">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">order_date</th>
<th data-quarto-table-cell-role="th">order_day_of_week</th>
<th data-quarto-table-cell-role="th">order_hour</th>
<th data-quarto-table-cell-role="th">delivery_status</th>
<th data-quarto-table-cell-role="th">payment_method</th>
<th data-quarto-table-cell-role="th">coupon_usage</th>
<th data-quarto-table-cell-role="th">delivery_fee</th>
<th data-quarto-table-cell-role="th">food_price</th>
<th data-quarto-table-cell-role="th">cooking_time_in_seconds</th>
<th data-quarto-table-cell-role="th">delivery_time_in_seconds</th>
<th data-quarto-table-cell-role="th">restaurant_id</th>
<th data-quarto-table-cell-role="th">restaurant_category</th>
<th data-quarto-table-cell-role="th">restaurant_type</th>
<th data-quarto-table-cell-role="th">province</th>
<th data-quarto-table-cell-role="th">nb_menu_items</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">11</td>
<td>1</td>
<td>Monday</td>
<td>12</td>
<td>CANCELED_BY_USER</td>
<td>CASH</td>
<td>NO COUPON</td>
<td>10.0</td>
<td>85.0</td>
<td>NaN</td>
<td>NaN</td>
<td>106</td>
<td>Delivery Only</td>
<td>NON-CHAIN</td>
<td>Bangkok</td>
<td>15.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">18</td>
<td>1</td>
<td>Monday</td>
<td>12</td>
<td>COMPLETED</td>
<td>CASH</td>
<td>NO COUPON</td>
<td>10.0</td>
<td>110.0</td>
<td>446.0</td>
<td>NaN</td>
<td>123</td>
<td>Rice Dish</td>
<td>NON-CHAIN</td>
<td>Pathum Thani</td>
<td>21.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">45</td>
<td>1</td>
<td>Monday</td>
<td>11</td>
<td>CANCELED_BY_RESTAURANT</td>
<td>CASH</td>
<td>COUPON USED</td>
<td>123.0</td>
<td>547.0</td>
<td>NaN</td>
<td>NaN</td>
<td>47</td>
<td>Dessert</td>
<td>CHAIN_RESTAURANT</td>
<td>Bangkok</td>
<td>29.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">73</td>
<td>1</td>
<td>Monday</td>
<td>11</td>
<td>CANCELED_BY_RESTAURANT</td>
<td>CASH</td>
<td>NO COUPON</td>
<td>0.0</td>
<td>189.0</td>
<td>NaN</td>
<td>NaN</td>
<td>46</td>
<td>Steak House/Barbeque</td>
<td>NON-CHAIN</td>
<td>Bangkok</td>
<td>52.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">80</td>
<td>1</td>
<td>Monday</td>
<td>19</td>
<td>CANCELED_BY_RESTAURANT</td>
<td>CASH</td>
<td>NO COUPON</td>
<td>0.0</td>
<td>105.0</td>
<td>NaN</td>
<td>NaN</td>
<td>87</td>
<td>Bakery/Cake</td>
<td>NON-CHAIN</td>
<td>Samut Sakhon</td>
<td>51.0</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Hypothesis: rows with null cooking time and delivery time is tied to delivery status that indicates failure.<br>
Checking delivery status for rows with null cooking time or delivery time, the hypothesis is likely true.</p>
<div id="cell-15" class="cell" data-execution_count="8">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>df.loc[df[<span class="st">"delivery_time_in_seconds"</span>].isna(), <span class="st">"delivery_status"</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>delivery_status
CANCELED_BY_USER             10464
CANCELED_BY_RESTAURANT        7573
EXPIRED_BY_DRIVER             1941
FAILED                         245
CANCELED_BY_DRIVER             233
CANCELED_BY_CS                 192
COMPLETED                      120
QUOTED                           8
PICK_UP_FAILED                   8
DRIVER_TO_DESTINATION            6
REJECTED_BY_DRIVER               5
RESTAURANT_ACCEPTED              3
DRIVER_ARRIVED_RESTAURANT        2
RE_ASSIGNING_DRIVER              1
USER_CONFIRMED_PRICE             1
ARRIVED                          1
RETURN_TO_SENDER_DONE            1
Name: count, dtype: int64</code></pre>
</div>
</div>
<div id="cell-16" class="cell" data-execution_count="9">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>df.loc[df[<span class="st">"cooking_time_in_seconds"</span>].isna(), <span class="st">"delivery_status"</span>].value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>delivery_status
CANCELED_BY_USER             10464
CANCELED_BY_RESTAURANT        7553
COMPLETED                     5424
EXPIRED_BY_DRIVER             1941
FAILED                         202
CANCELED_BY_DRIVER             180
CANCELED_BY_CS                 173
PICK_UP_FAILED                   8
QUOTED                           8
REJECTED_BY_DRIVER               5
RESTAURANT_ACCEPTED              3
DRIVER_ARRIVED_RESTAURANT        2
RE_ASSIGNING_DRIVER              1
DROP_OFF_DONE                    1
USER_CONFIRMED_PRICE             1
Name: count, dtype: int64</code></pre>
</div>
</div>
<p>Confirm that delivery status that indicates failure truly corresponds with null delivery time and cooking time.</p>
<div id="cell-18" class="cell scrolling" data-execution_count="10">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> count_na_by_status(status, normalize<span class="op">=</span><span class="va">True</span>):</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>        df.loc[df[<span class="st">"delivery_status"</span>] <span class="op">==</span> status, <span class="st">"delivery_time_in_seconds"</span>]</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>        .value_counts(dropna<span class="op">=</span><span class="va">False</span>, normalize<span class="op">=</span>normalize)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>        .head(<span class="dv">1</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>        df.loc[df[<span class="st">"delivery_status"</span>] <span class="op">==</span> status, <span class="st">"cooking_time_in_seconds"</span>]</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>        .value_counts(dropna<span class="op">=</span><span class="va">False</span>, normalize<span class="op">=</span>normalize)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>        .head(<span class="dv">1</span>)</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> status <span class="kw">in</span> df[<span class="st">"delivery_status"</span>].unique():</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> status <span class="op">==</span> <span class="st">"COMPLETED"</span>:</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(status)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    count_na_by_status(status)</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>CANCELED_BY_USER
delivery_time_in_seconds
NaN    1.0
Name: proportion, dtype: float64
cooking_time_in_seconds
NaN    1.0
Name: proportion, dtype: float64

CANCELED_BY_RESTAURANT
delivery_time_in_seconds
NaN    1.0
Name: proportion, dtype: float64
cooking_time_in_seconds
NaN    0.997359
Name: proportion, dtype: float64

CANCELED_BY_DRIVER
delivery_time_in_seconds
NaN    1.0
Name: proportion, dtype: float64
cooking_time_in_seconds
NaN    0.772532
Name: proportion, dtype: float64

FAILED
delivery_time_in_seconds
NaN    0.995935
Name: proportion, dtype: float64
cooking_time_in_seconds
NaN    0.821138
Name: proportion, dtype: float64

EXPIRED_BY_DRIVER
delivery_time_in_seconds
NaN    1.0
Name: proportion, dtype: float64
cooking_time_in_seconds
NaN    1.0
Name: proportion, dtype: float64

DRIVER_TO_DESTINATION
delivery_time_in_seconds
NaN    1.0
Name: proportion, dtype: float64
cooking_time_in_seconds
1916.0    0.166667
Name: proportion, dtype: float64

DROP_OFF_DONE
delivery_time_in_seconds
297.0    0.022727
Name: proportion, dtype: float64
cooking_time_in_seconds
567.0    0.022727
Name: proportion, dtype: float64

REJECTED_BY_DRIVER
delivery_time_in_seconds
NaN    0.714286
Name: proportion, dtype: float64
cooking_time_in_seconds
NaN    0.714286
Name: proportion, dtype: float64

PICK_UP_FAILED
delivery_time_in_seconds
NaN    1.0
Name: proportion, dtype: float64
cooking_time_in_seconds
NaN    1.0
Name: proportion, dtype: float64

RE_ASSIGNING_DRIVER
delivery_time_in_seconds
NaN    1.0
Name: proportion, dtype: float64
cooking_time_in_seconds
NaN    1.0
Name: proportion, dtype: float64

RESTAURANT_ACCEPTED
delivery_time_in_seconds
NaN    1.0
Name: proportion, dtype: float64
cooking_time_in_seconds
NaN    1.0
Name: proportion, dtype: float64

DRIVER_ARRIVED_RESTAURANT
delivery_time_in_seconds
NaN    1.0
Name: proportion, dtype: float64
cooking_time_in_seconds
NaN    1.0
Name: proportion, dtype: float64

USER_CONFIRMED_PRICE
delivery_time_in_seconds
NaN    1.0
Name: proportion, dtype: float64
cooking_time_in_seconds
NaN    1.0
Name: proportion, dtype: float64

QUOTED
delivery_time_in_seconds
NaN    1.0
Name: proportion, dtype: float64
cooking_time_in_seconds
NaN    1.0
Name: proportion, dtype: float64

ARRIVED
delivery_time_in_seconds
NaN    1.0
Name: proportion, dtype: float64
cooking_time_in_seconds
569.0    1.0
Name: proportion, dtype: float64

RETURN_TO_SENDER_DONE
delivery_time_in_seconds
NaN    1.0
Name: proportion, dtype: float64
cooking_time_in_seconds
884.0    1.0
Name: proportion, dtype: float64

CANCELED_BY_CS
delivery_time_in_seconds
NaN    1.0
Name: proportion, dtype: float64
cooking_time_in_seconds
NaN    0.901042
Name: proportion, dtype: float64
</code></pre>
</div>
</div>
<p>Drop rows with delivery status indicating failure.</p>
<div id="cell-20" class="cell" data-execution_count="11">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>status_fail <span class="op">=</span> [</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"CANCELED_BY_USER"</span>,</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"CANCELED_BY_RESTAURANT"</span>,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"EXPIRED_BY_DRIVER"</span>,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"FAILED"</span>,</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"CANCELED_BY_DRIVER"</span>,</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"CANCELED_BY_CS"</span>,</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"PICK_UP_FAILED"</span>,</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"REJECTED_BY_DRIVER"</span>,</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.loc[<span class="op">~</span>df[<span class="st">"delivery_status"</span>].isin(status_fail)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Check the remaining rows for null value</p>
<div id="cell-22" class="cell" data-execution_count="12">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>df.isna().<span class="bu">sum</span>().sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>nb_menu_items               5494
cooking_time_in_seconds     5440
delivery_time_in_seconds     143
order_date                     0
order_day_of_week              0
order_hour                     0
delivery_status                0
payment_method                 0
coupon_usage                   0
delivery_fee                   0
food_price                     0
restaurant_id                  0
restaurant_category            0
restaurant_type                0
province                       0
dtype: int64</code></pre>
</div>
</div>
</section>
<section id="data-imputation" class="level3" data-number="1.2">
<h3 data-number="1.2" class="anchored" data-anchor-id="data-imputation"><span class="header-section-number">1.2</span> Data Imputation</h3>
<p>Number of menu items will not likely be used in the model, just fill with the its median.</p>
<div id="cell-24" class="cell" data-execution_count="13">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"nb_menu_items"</span>] <span class="op">=</span> df[<span class="st">"nb_menu_items"</span>].fillna(df[<span class="st">"nb_menu_items"</span>].median())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Delivery time contains just 143 null values, which is not a lot, simply impute with median is appropriate.</p>
<div id="cell-26" class="cell" data-execution_count="14">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">"delivery_time_in_seconds"</span>] <span class="op">=</span> df[<span class="st">"delivery_time_in_seconds"</span>].fillna(</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"delivery_time_in_seconds"</span>].median()</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Cooking time contains a relatively large number of null values, consider imputing the value according to the median cooking time grouped by restaurant category. (Cooking time is likely depends on restaurant category.)</p>
<p>Checking for distribution of restaurant cateogry on rows containing null cooking time.</p>
<p>Calculate the median cooking time grouped by restaurant category. Impute missing values using the calculated values.</p>
<div id="cell-29" class="cell" data-execution_count="15">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>med_cooking_time <span class="op">=</span> df.groupby(<span class="st">"restaurant_category"</span>)[<span class="st">"cooking_time_in_seconds"</span>].median()</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>med_cooking_time[med_cooking_time.isna()] <span class="op">=</span> df[<span class="st">"cooking_time_in_seconds"</span>].median()</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>med_cooking_time.plot(kind<span class="op">=</span><span class="st">"bar"</span>, title<span class="op">=</span><span class="st">"Median cooking time by restaurant category"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-16-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-30" class="cell" data-execution_count="16">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>df.loc[df[<span class="st">"cooking_time_in_seconds"</span>].isna(), <span class="st">"cooking_time_in_seconds"</span>] <span class="op">=</span> df.loc[</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"cooking_time_in_seconds"</span>].isna(), <span class="st">"restaurant_category"</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>].<span class="bu">map</span>(med_cooking_time)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Visualizing cooking time distribution after imputation.</p>
<div id="cell-32" class="cell" data-execution_count="17">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>quantile <span class="op">=</span> df[<span class="st">"cooking_time_in_seconds"</span>].quantile([<span class="fl">0.25</span>, <span class="fl">0.75</span>])</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>iqr <span class="op">=</span> quantile[<span class="fl">0.75</span>] <span class="op">-</span> quantile[<span class="fl">0.25</span>]</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>sns.histplot(</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    df.loc[</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">"cooking_time_in_seconds"</span>] <span class="op">&lt;=</span> quantile[<span class="fl">0.75</span>] <span class="op">+</span> <span class="dv">2</span> <span class="op">*</span> iqr,</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">"cooking_time_in_seconds"</span>,</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    kde<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>).set_title(<span class="st">"Cooking time distribution"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>Text(0.5, 1.0, 'Cooking time distribution')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-18-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Visualizing delivery time distribution.</p>
<div id="cell-34" class="cell" data-execution_count="18">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>quantile <span class="op">=</span> df[<span class="st">"delivery_time_in_seconds"</span>].quantile([<span class="fl">0.25</span>, <span class="fl">0.75</span>])</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>iqr <span class="op">=</span> quantile[<span class="fl">0.75</span>] <span class="op">-</span> quantile[<span class="fl">0.25</span>]</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>sns.histplot(</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    df.loc[</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>        df[<span class="st">"delivery_time_in_seconds"</span>] <span class="op">&lt;=</span> quantile[<span class="fl">0.75</span>] <span class="op">+</span> <span class="dv">2</span> <span class="op">*</span> iqr,</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>        <span class="st">"delivery_time_in_seconds"</span>,</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    kde<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>).set_title(<span class="st">"Delivery time distribution"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>Text(0.5, 1.0, 'Delivery time distribution')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-19-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>There seems to be a lot of orders with almost zero delivery time.</p>
<div id="cell-36" class="cell" data-execution_count="19">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>df[df[<span class="st">"delivery_time_in_seconds"</span>] <span class="op">&lt;=</span> <span class="dv">10</span>].describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="19">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">order_date</th>
<th data-quarto-table-cell-role="th">order_hour</th>
<th data-quarto-table-cell-role="th">delivery_fee</th>
<th data-quarto-table-cell-role="th">food_price</th>
<th data-quarto-table-cell-role="th">cooking_time_in_seconds</th>
<th data-quarto-table-cell-role="th">delivery_time_in_seconds</th>
<th data-quarto-table-cell-role="th">restaurant_id</th>
<th data-quarto-table-cell-role="th">nb_menu_items</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">count</td>
<td>2626.000000</td>
<td>2626.000000</td>
<td>2626.000000</td>
<td>2626.000000</td>
<td>2626.000000</td>
<td>2626.000000</td>
<td>2626.000000</td>
<td>2626.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">mean</td>
<td>142.816832</td>
<td>14.592155</td>
<td>16.795887</td>
<td>184.114676</td>
<td>1362.166032</td>
<td>4.490099</td>
<td>94.992003</td>
<td>82.664128</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">std</td>
<td>83.820281</td>
<td>4.135892</td>
<td>33.168905</td>
<td>212.140257</td>
<td>2071.918362</td>
<td>2.300331</td>
<td>49.806218</td>
<td>78.061514</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">min</td>
<td>1.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>0.000000</td>
<td>4.000000</td>
<td>0.000000</td>
<td>1.000000</td>
<td>1.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">25%</td>
<td>76.000000</td>
<td>11.000000</td>
<td>0.000000</td>
<td>70.000000</td>
<td>861.250000</td>
<td>3.000000</td>
<td>55.000000</td>
<td>34.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">50%</td>
<td>137.500000</td>
<td>14.000000</td>
<td>8.500000</td>
<td>120.000000</td>
<td>1147.500000</td>
<td>4.000000</td>
<td>101.000000</td>
<td>61.000000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">75%</td>
<td>207.000000</td>
<td>18.000000</td>
<td>15.000000</td>
<td>204.500000</td>
<td>1559.000000</td>
<td>6.000000</td>
<td>137.000000</td>
<td>105.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">max</td>
<td>365.000000</td>
<td>23.000000</td>
<td>391.000000</td>
<td>1950.000000</td>
<td>76956.000000</td>
<td>10.000000</td>
<td>200.000000</td>
<td>969.000000</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="feature-selection" class="level3" data-number="1.3">
<h3 data-number="1.3" class="anchored" data-anchor-id="feature-selection"><span class="header-section-number">1.3</span> Feature Selection</h3>
<p>Drop columns that will obviously not go into the model. Delivery status now contains status of COMPLETED almost exclusively. Restaurant ID provides no value in the model.</p>
<div id="cell-38" class="cell" data-execution_count="20">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> df.drop(columns<span class="op">=</span>[<span class="st">"delivery_status"</span>, <span class="st">"restaurant_id"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>List the remaining potential columns.</p>
<div id="cell-40" class="cell" data-execution_count="21">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>df2.dtypes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="21">
<pre><code>order_date                    int64
order_day_of_week            object
order_hour                    int64
payment_method               object
coupon_usage                 object
delivery_fee                float64
food_price                  float64
cooking_time_in_seconds     float64
delivery_time_in_seconds    float64
restaurant_category          object
restaurant_type              object
province                     object
nb_menu_items               float64
dtype: object</code></pre>
</div>
</div>
<p>Calculate feature importance based on permutation importance score on a trained random forest regressor.</p>
<div id="cell-42" class="cell" data-execution_count="22">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_permutation_importance(pipe, x, y, target):</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    plt.figure()</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> permutation_importance(pipe, x, y, n_repeats<span class="op">=</span><span class="dv">10</span>, random_state<span class="op">=</span><span class="dv">1</span>, n_jobs<span class="op">=-</span><span class="dv">1</span>)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    importances <span class="op">=</span> pd.DataFrame(</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>        result.importances.T,</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>        columns<span class="op">=</span>x.columns,</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>    importances.mean().sort_values(ascending<span class="op">=</span><span class="va">False</span>).plot(</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>        kind<span class="op">=</span><span class="st">"bar"</span>, title<span class="op">=</span><span class="st">"Feature importance for target "</span> <span class="op">+</span> target</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_feature_importance(target):</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> df2.drop(columns<span class="op">=</span>[target])</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> df2[target]</span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>    X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, random_state<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>    ordinal_encoder <span class="op">=</span> OrdinalEncoder()</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>    one_hot_encoder <span class="op">=</span> OneHotEncoder(drop<span class="op">=</span><span class="st">"first"</span>)</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>    column_transformer <span class="op">=</span> ColumnTransformer(</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>        [</span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>            (<span class="st">"ordinal"</span>, ordinal_encoder, [<span class="st">"order_day_of_week"</span>]),</span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>            (</span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>                <span class="st">"nominal"</span>,</span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>                one_hot_encoder,</span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>                [</span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"payment_method"</span>,</span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"coupon_usage"</span>,</span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"restaurant_category"</span>,</span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"restaurant_type"</span>,</span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a>                    <span class="st">"province"</span>,</span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a>                ],</span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a>            ),</span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a>        ],</span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a>        remainder<span class="op">=</span><span class="st">"passthrough"</span>,</span>
<span id="cb29-37"><a href="#cb29-37" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb29-38"><a href="#cb29-38" aria-hidden="true" tabindex="-1"></a>    pipe <span class="op">=</span> make_pipeline(</span>
<span id="cb29-39"><a href="#cb29-39" aria-hidden="true" tabindex="-1"></a>        column_transformer,</span>
<span id="cb29-40"><a href="#cb29-40" aria-hidden="true" tabindex="-1"></a>        RandomForestRegressor(n_jobs<span class="op">=-</span><span class="dv">1</span>, random_state<span class="op">=</span><span class="dv">1</span>, max_depth<span class="op">=</span><span class="dv">5</span>),</span>
<span id="cb29-41"><a href="#cb29-41" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb29-42"><a href="#cb29-42" aria-hidden="true" tabindex="-1"></a>    pipe.fit(X_train, y_train)</span>
<span id="cb29-43"><a href="#cb29-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-44"><a href="#cb29-44" aria-hidden="true" tabindex="-1"></a>    calculate_permutation_importance(pipe, X_test, y_test, target)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Rank feature importance for cooking time.</p>
<div id="cell-44" class="cell" data-execution_count="23">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>calculate_feature_importance(<span class="st">"cooking_time_in_seconds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-24-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Rank feature importance for delivery time.</p>
<div id="cell-46" class="cell" data-execution_count="24">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>calculate_feature_importance(<span class="st">"delivery_time_in_seconds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-25-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="delivery-time-and-cooking-time-anomaly-detection" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="delivery-time-and-cooking-time-anomaly-detection"><span class="header-section-number">2</span> Delivery time and cooking time anomaly detection</h2>
<p>Based on the calculated feature importance, additional variables to include for anomaly detection for delivery time will be delivery fee. Additional variables for cooking time will be food price and restaurant category. (Delivery time is most likely not related to cooking time.)</p>
<section id="delivery-time-anomaly-detection" class="level3" data-number="2.1">
<h3 data-number="2.1" class="anchored" data-anchor-id="delivery-time-anomaly-detection"><span class="header-section-number">2.1</span> Delivery time anomaly detection</h3>
<p>Visualizing the distribution of delivery fee, does not looks like a Gaussian distribution.</p>
<div id="cell-50" class="cell" data-execution_count="25">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>sns.kdeplot(x<span class="op">=</span>df[<span class="st">"delivery_fee"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-26-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Calculate an approximated percentage of delivery time outlier according to the empirical rule that most data lies between <span class="math inline">\(Q_1-1.5\ \text{IQR}\)</span> and <span class="math inline">\(Q_3+1.5\ \text{IQR}\)</span> .</p>
<div id="cell-52" class="cell" data-execution_count="26">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>quantile <span class="op">=</span> df[<span class="st">"delivery_time_in_seconds"</span>].quantile([<span class="fl">0.25</span>, <span class="fl">0.75</span>])</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>iqr <span class="op">=</span> quantile[<span class="fl">0.75</span>] <span class="op">-</span> quantile[<span class="fl">0.25</span>]</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>df[df[<span class="st">"delivery_time_in_seconds"</span>] <span class="op">&gt;</span> quantile[<span class="fl">0.75</span>] <span class="op">+</span> <span class="fl">1.5</span> <span class="op">*</span> iqr].shape[<span class="dv">0</span>] <span class="op">/</span> df.shape[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="26">
<pre><code>0.044412886698410044</code></pre>
</div>
</div>
<p>Fit an isolation forest for detecting anomalous delivery time with contamination parameter set to the approximated outlier percentage.</p>
<div id="cell-54" class="cell" data-execution_count="27">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df[[<span class="st">"delivery_fee"</span>, <span class="st">"delivery_time_in_seconds"</span>]]</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>detector <span class="op">=</span> IsolationForest(random_state<span class="op">=</span><span class="dv">1</span>, contamination<span class="op">=</span><span class="fl">0.0444</span>)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>detector.fit(X)</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">20</span>))</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>disp <span class="op">=</span> DecisionBoundaryDisplay.from_estimator(</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>    detector,</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>    X[(X[<span class="st">"delivery_fee"</span>] <span class="op">&lt;</span> <span class="dv">200</span>) <span class="op">&amp;</span> (X[<span class="st">"delivery_time_in_seconds"</span>] <span class="op">&lt;</span> <span class="dv">10000</span>)],</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>    response_method<span class="op">=</span><span class="st">"predict"</span>,</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>    alpha<span class="op">=</span><span class="fl">0.5</span>,</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Delivery time anomaly detection"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="27">
<pre><code>Text(0.5, 1.0, 'Delivery time anomaly detection')</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>&lt;Figure size 2000x2000 with 0 Axes&gt;</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-28-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="cooking-time-anomaly-detection" class="level3" data-number="2.2">
<h3 data-number="2.2" class="anchored" data-anchor-id="cooking-time-anomaly-detection"><span class="header-section-number">2.2</span> Cooking time anomaly detection</h3>
<div id="cell-56" class="cell" data-execution_count="28">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>sns.kdeplot(x<span class="op">=</span>df.loc[df[<span class="st">"food_price"</span>] <span class="op">&lt;</span> <span class="dv">3000</span>, <span class="st">"food_price"</span>]).set_title(</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Food price distribution"</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="28">
<pre><code>Text(0.5, 1.0, 'Food price distribution')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-29-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-57" class="cell scrolling" data-execution_count="29">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>tmp <span class="op">=</span> df2[df2[<span class="st">"cooking_time_in_seconds"</span>] <span class="op">&lt;</span> <span class="dv">6000</span>]</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>sns.displot(</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    tmp,</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"cooking_time_in_seconds"</span>,</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    common_norm<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>    col<span class="op">=</span><span class="st">"restaurant_category"</span>,</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>    col_wrap<span class="op">=</span><span class="dv">3</span>,</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>    bins<span class="op">=</span><span class="dv">50</span>,</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>    kde<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-30-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Approximate the outlier percentage for cooking time in the same way.</p>
<div id="cell-59" class="cell" data-execution_count="30">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>quantile <span class="op">=</span> df[<span class="st">"cooking_time_in_seconds"</span>].quantile([<span class="fl">0.25</span>, <span class="fl">0.75</span>])</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>iqr <span class="op">=</span> quantile[<span class="fl">0.75</span>] <span class="op">-</span> quantile[<span class="fl">0.25</span>]</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>df[df[<span class="st">"cooking_time_in_seconds"</span>] <span class="op">&gt;</span> quantile[<span class="fl">0.75</span>] <span class="op">+</span> <span class="fl">1.5</span> <span class="op">*</span> iqr].shape[<span class="dv">0</span>] <span class="op">/</span> df.shape[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="30">
<pre><code>0.040616675484272176</code></pre>
</div>
</div>
<p>Fit an isolation forest for detecting anomalous cooking time. Using sklearn pipeline to first transform categorical features.</p>
<div id="cell-61" class="cell" data-execution_count="31">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> df[[<span class="st">"food_price"</span>, <span class="st">"cooking_time_in_seconds"</span>, <span class="st">"restaurant_category"</span>]].copy()</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>column_transformer <span class="op">=</span> ColumnTransformer(</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>        (</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">"nominal"</span>,</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>            OneHotEncoder(drop<span class="op">=</span><span class="st">"first"</span>, sparse_output<span class="op">=</span><span class="va">False</span>),</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>            [<span class="st">"restaurant_category"</span>],</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>    remainder<span class="op">=</span><span class="st">"passthrough"</span>,</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> column_transformer.fit_transform(data)</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>detector <span class="op">=</span> IsolationForest(random_state<span class="op">=</span><span class="dv">1</span>, contamination<span class="op">=</span><span class="fl">0.0406</span>)</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>outlier <span class="op">=</span> detector.fit_predict(X)</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>data[<span class="st">"outlier"</span>] <span class="op">=</span> outlier <span class="op">==</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, sharey<span class="op">=</span><span class="va">True</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(</span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"food_price"</span>,</span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">"cooking_time_in_seconds"</span>,</span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a>    hue<span class="op">=</span><span class="st">"outlier"</span>,</span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>data[</span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a>        (data[<span class="st">"cooking_time_in_seconds"</span>] <span class="op">&lt;</span> <span class="dv">3600</span>)</span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a>        <span class="op">&amp;</span> (data[<span class="st">"food_price"</span>] <span class="op">&lt;</span> <span class="dv">2000</span>)</span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a>        <span class="op">&amp;</span> (data[<span class="st">"restaurant_category"</span>] <span class="op">==</span> <span class="st">" La Carte"</span>)</span>
<span id="cb43-29"><a href="#cb43-29" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb43-30"><a href="#cb43-30" aria-hidden="true" tabindex="-1"></a>    alpha<span class="op">=</span><span class="fl">0.7</span>,</span>
<span id="cb43-31"><a href="#cb43-31" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax[<span class="dv">0</span>],</span>
<span id="cb43-32"><a href="#cb43-32" aria-hidden="true" tabindex="-1"></a>).set_title(<span class="st">" La Carte cooking time"</span>)</span>
<span id="cb43-33"><a href="#cb43-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-34"><a href="#cb43-34" aria-hidden="true" tabindex="-1"></a>sns.scatterplot(</span>
<span id="cb43-35"><a href="#cb43-35" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"food_price"</span>,</span>
<span id="cb43-36"><a href="#cb43-36" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">"cooking_time_in_seconds"</span>,</span>
<span id="cb43-37"><a href="#cb43-37" aria-hidden="true" tabindex="-1"></a>    hue<span class="op">=</span><span class="st">"outlier"</span>,</span>
<span id="cb43-38"><a href="#cb43-38" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>data[</span>
<span id="cb43-39"><a href="#cb43-39" aria-hidden="true" tabindex="-1"></a>        (data[<span class="st">"cooking_time_in_seconds"</span>] <span class="op">&lt;</span> <span class="dv">3600</span>)</span>
<span id="cb43-40"><a href="#cb43-40" aria-hidden="true" tabindex="-1"></a>        <span class="op">&amp;</span> (data[<span class="st">"food_price"</span>] <span class="op">&lt;</span> <span class="dv">2000</span>)</span>
<span id="cb43-41"><a href="#cb43-41" aria-hidden="true" tabindex="-1"></a>        <span class="op">&amp;</span> (data[<span class="st">"restaurant_category"</span>] <span class="op">==</span> <span class="st">"Sukiyaki/Shabu"</span>)</span>
<span id="cb43-42"><a href="#cb43-42" aria-hidden="true" tabindex="-1"></a>    ],</span>
<span id="cb43-43"><a href="#cb43-43" aria-hidden="true" tabindex="-1"></a>    alpha<span class="op">=</span><span class="fl">0.7</span>,</span>
<span id="cb43-44"><a href="#cb43-44" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax[<span class="dv">1</span>],</span>
<span id="cb43-45"><a href="#cb43-45" aria-hidden="true" tabindex="-1"></a>).set_title(<span class="st">"Sukiyaki/Shabu cooking time"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="31">
<pre><code>Text(0.5, 1.0, 'Sukiyaki/Shabu cooking time')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-32-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="order-volume-anomaly-detection" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="order-volume-anomaly-detection"><span class="header-section-number">3</span> Order volume anomaly detection</h2>
<p>Get order volume for each restaurant by day, only considering completed order.</p>
<div id="cell-64" class="cell" data-execution_count="32">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>volume <span class="op">=</span> (</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>    df[df[<span class="st">"delivery_status"</span>] <span class="op">==</span> <span class="st">"COMPLETED"</span>]</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>    .groupby([<span class="st">"restaurant_id"</span>, <span class="st">"order_date"</span>])</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>    .size()</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>    .reset_index(name<span class="op">=</span><span class="st">"volume"</span>)</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Fill in zeros for days without order.</p>
<div id="cell-66" class="cell" data-execution_count="33">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>volume <span class="op">=</span> (</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>    volume.set_index([<span class="st">"restaurant_id"</span>, <span class="st">"order_date"</span>])</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>    .unstack(level<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>    .fillna(<span class="dv">0</span>)</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>    .stack()</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>    .reset_index()</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-67" class="cell" data-execution_count="34">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>volume</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="34">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">restaurant_id</th>
<th data-quarto-table-cell-role="th">order_date</th>
<th data-quarto-table-cell-role="th">volume</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>1</td>
<td>1</td>
<td>2.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>1</td>
<td>2</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>1</td>
<td>3</td>
<td>2.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>1</td>
<td>4</td>
<td>2.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>1</td>
<td>5</td>
<td>4.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">72995</td>
<td>200</td>
<td>361</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">72996</td>
<td>200</td>
<td>362</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">72997</td>
<td>200</td>
<td>363</td>
<td>0.0</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">72998</td>
<td>200</td>
<td>364</td>
<td>0.0</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">72999</td>
<td>200</td>
<td>365</td>
<td>0.0</td>
</tr>
</tbody>
</table>

<p>73000 rows  3 columns</p>
</div>
</div>
</div>
<section id="visualizing-the-order-volumes-across-all-restaurants." class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="visualizing-the-order-volumes-across-all-restaurants."><span class="header-section-number">3.1</span> Visualizing the order volumes across all restaurants.</h3>
<div id="cell-69" class="cell" data-execution_count="35">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.figure(figsize=(20, 10))</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="co"># volume.groupby("order_date")["volume"].sum().plot(title="Total volume by date")</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>total_volume <span class="op">=</span> volume.groupby(<span class="st">"order_date"</span>)[<span class="st">"volume"</span>].<span class="bu">sum</span>()</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.graphics.tsaplots <span class="im">import</span> plot_acf, plot_pacf</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>total_volume.plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-36-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-70" class="cell" data-execution_count="36">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.stattools <span class="im">import</span> adfuller</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>vol_diff <span class="op">=</span> total_volume.diff().dropna()</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>vol_diff.plot()</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> adfuller(vol_diff)</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"ADF Statistic:"</span>, result[<span class="dv">0</span>])</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"p-value:"</span>, result[<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>ADF Statistic: -8.396370654328338
p-value: 2.293225310779515e-13</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-37-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-71" class="cell" data-execution_count="37">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>plot_acf(vol_diff)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>plot_pacf(vol_diff)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="37">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-38-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-38-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-38-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-72" class="cell" data-execution_count="38">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>top5_mean <span class="op">=</span> (</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>    volume.groupby(<span class="st">"restaurant_id"</span>)[<span class="st">"volume"</span>]</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>    .mean()</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>    .sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>    .head(<span class="dv">5</span>)</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>    .index</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>top5_volatile <span class="op">=</span> (</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>    volume.groupby(<span class="st">"restaurant_id"</span>)[<span class="st">"volume"</span>]</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>    .std()</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>    .sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>    .head(<span class="dv">5</span>)</span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>    .index</span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>bottom5_mean <span class="op">=</span> (</span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>    volume.groupby(<span class="st">"restaurant_id"</span>)[<span class="st">"volume"</span>]</span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>    .mean()</span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a>    .sort_values(ascending<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>    .head(<span class="dv">5</span>)</span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a>    .index</span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="restaurants-with-high-volume" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="restaurants-with-high-volume"><span class="header-section-number">3.2</span> Restaurants with high volume</h3>
<div id="cell-74" class="cell" data-execution_count="39">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>sns.relplot(</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>    volume[volume[<span class="st">"restaurant_id"</span>].isin(top5_mean)],</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"order_date"</span>,</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">"volume"</span>,</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>    col<span class="op">=</span><span class="st">"restaurant_id"</span>,</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>    col_wrap<span class="op">=</span><span class="dv">3</span>,</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>    kind<span class="op">=</span><span class="st">"line"</span>,</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-40-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-75" class="cell" data-execution_count="40">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>vol_highmean <span class="op">=</span> volume.loc[volume[<span class="st">"restaurant_id"</span>] <span class="op">==</span> <span class="dv">39</span>, <span class="st">"volume"</span>].reset_index(</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>    drop<span class="op">=</span><span class="va">True</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>vol_highmean.plot().set_title(<span class="st">"Restaurant with high mean volume"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="40">
<pre><code>Text(0.5, 1.0, 'Restaurant with high mean volume')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-41-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-76" class="cell" data-execution_count="41">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>vol_highmean_diff <span class="op">=</span> vol_highmean.diff().dropna()</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>vol_highmean_diff.plot().set_title(<span class="st">"First difference of volume"</span>)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> adfuller(vol_diff)</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"ADF Statistic:"</span>, result[<span class="dv">0</span>])</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"p-value:"</span>, result[<span class="dv">1</span>])</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>plot_acf(vol_highmean_diff)</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>plot_pacf(vol_highmean_diff)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>ADF Statistic: -8.396370654328338
p-value: 2.293225310779515e-13</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="41">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-42-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-42-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-42-output-4.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-42-output-5.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="restaurants-with-low-volume" class="level3" data-number="3.3">
<h3 data-number="3.3" class="anchored" data-anchor-id="restaurants-with-low-volume"><span class="header-section-number">3.3</span> Restaurants with low volume</h3>
<div id="cell-78" class="cell" data-execution_count="42">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>sns.relplot(</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>    volume[volume[<span class="st">"restaurant_id"</span>].isin(bottom5_mean)],</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"order_date"</span>,</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">"volume"</span>,</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>    col<span class="op">=</span><span class="st">"restaurant_id"</span>,</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>    col_wrap<span class="op">=</span><span class="dv">3</span>,</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>    kind<span class="op">=</span><span class="st">"line"</span>,</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-43-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-79" class="cell" data-execution_count="43">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>vol_lowmean <span class="op">=</span> volume.loc[volume[<span class="st">"restaurant_id"</span>] <span class="op">==</span> <span class="dv">92</span>, <span class="st">"volume"</span>].reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>vol_lowmean.plot().set_title(<span class="st">"Restaurant with low mean volume"</span>)</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> adfuller(vol_lowmean)</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"ADF Statistic:"</span>, result[<span class="dv">0</span>])</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"p-value:"</span>, result[<span class="dv">1</span>])</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>plot_acf(vol_lowmean)</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>plot_pacf(vol_lowmean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>ADF Statistic: -4.805716142356635
p-value: 5.303301074102594e-05</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="43">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-44-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-44-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-44-output-4.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-44-output-5.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="restaurants-with-high-volume-volatility" class="level3" data-number="3.4">
<h3 data-number="3.4" class="anchored" data-anchor-id="restaurants-with-high-volume-volatility"><span class="header-section-number">3.4</span> Restaurants with high volume volatility</h3>
<div id="cell-81" class="cell" data-execution_count="44">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>sns.relplot(</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>    volume[volume[<span class="st">"restaurant_id"</span>].isin(top5_volatile)],</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"order_date"</span>,</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">"volume"</span>,</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>    col<span class="op">=</span><span class="st">"restaurant_id"</span>,</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>    col_wrap<span class="op">=</span><span class="dv">3</span>,</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>    kind<span class="op">=</span><span class="st">"line"</span>,</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-45-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-82" class="cell" data-execution_count="45">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>vol_volatile <span class="op">=</span> volume.loc[volume[<span class="st">"restaurant_id"</span>] <span class="op">==</span> <span class="dv">152</span>, <span class="st">"volume"</span>].reset_index(</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>    drop<span class="op">=</span><span class="va">True</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>vol_volatile.plot().set_title(<span class="st">"Resaturant with volatile volume"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="45">
<pre><code>Text(0.5, 1.0, 'Resaturant with volatile volume')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-46-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-83" class="cell" data-execution_count="46">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>vol_volatile_diff <span class="op">=</span> vol_volatile.diff().dropna()</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>vol_volatile_diff.plot().set_title(<span class="st">"First difference of volume"</span>)</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> adfuller(vol_volatile_diff)</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"ADF Statistic:"</span>, result[<span class="dv">0</span>])</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"p-value:"</span>, result[<span class="dv">1</span>])</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>plot_acf(vol_volatile_diff)</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>plot_pacf(vol_volatile_diff)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>ADF Statistic: -7.3705485810778155
p-value: 8.995890685246919e-11</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="46">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-47-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-47-output-3.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-47-output-4.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-47-output-5.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="the-anomaly-detection-model" class="level3" data-number="3.5">
<h3 data-number="3.5" class="anchored" data-anchor-id="the-anomaly-detection-model"><span class="header-section-number">3.5</span> The Anomaly Detection Model</h3>
<p>Train ARIMA model to forecast future volumes. If predicted volume and observed volume does not fall in the calculated confidence interval, label that data point an outlier.</p>
<div id="cell-86" class="cell" data-execution_count="47">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> detect_anomaly(restaurant_id, alpha<span class="op">=</span><span class="fl">0.05</span>):</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> volume.loc[volume[<span class="st">"restaurant_id"</span>] <span class="op">==</span> restaurant_id, <span class="st">"volume"</span>]</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>    train, test <span class="op">=</span> data.iloc[:<span class="op">-</span><span class="dv">10</span>], data.iloc[<span class="op">-</span><span class="dv">10</span>:]</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> pm.auto_arima(train.to_numpy())</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>    pred, confint <span class="op">=</span> model.predict(<span class="dv">10</span>, return_conf_int<span class="op">=</span><span class="va">True</span>, alpha<span class="op">=</span>alpha)</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">5</span>))</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>    x0 <span class="op">=</span> np.arange(data.shape[<span class="dv">0</span>])</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>    plt.plot(x0, data, alpha<span class="op">=</span><span class="fl">0.7</span>, label<span class="op">=</span><span class="st">"actual volume"</span>)</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>    plt.scatter(x0[<span class="op">-</span><span class="dv">10</span>:], pred, marker<span class="op">=</span><span class="st">"x"</span>, label<span class="op">=</span><span class="st">"predicted volume"</span>)</span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>    plt.fill_between(</span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>        x0[<span class="op">-</span><span class="dv">10</span>:],</span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>        confint[:, <span class="dv">0</span>],</span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>        confint[:, <span class="dv">1</span>],</span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a>        alpha<span class="op">=</span><span class="fl">0.1</span>,</span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span><span class="st">"b"</span>,</span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a>        label<span class="op">=</span><span class="st">"confidence interval"</span>,</span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a>    anomaly <span class="op">=</span> (test <span class="op">&lt;</span> confint[:, <span class="dv">0</span>]) <span class="op">|</span> (test <span class="op">&gt;</span> confint[:, <span class="dv">1</span>])</span>
<span id="cb66-23"><a href="#cb66-23" aria-hidden="true" tabindex="-1"></a>    plt.scatter(</span>
<span id="cb66-24"><a href="#cb66-24" aria-hidden="true" tabindex="-1"></a>        x0[<span class="op">-</span><span class="dv">10</span>:][anomaly], test[anomaly], marker<span class="op">=</span><span class="st">"x"</span>, color<span class="op">=</span><span class="st">"r"</span>, label<span class="op">=</span><span class="st">"anomaly"</span></span>
<span id="cb66-25"><a href="#cb66-25" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb66-26"><a href="#cb66-26" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">"Volume"</span>)</span>
<span id="cb66-27"><a href="#cb66-27" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">"Day"</span>)</span>
<span id="cb66-28"><a href="#cb66-28" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">"Restaurant Order Volume"</span>)</span>
<span id="cb66-29"><a href="#cb66-29" aria-hidden="true" tabindex="-1"></a>    plt.legend()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-87" class="cell" data-execution_count="48">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>detect_anomaly(<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-49-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-88" class="cell" data-execution_count="49">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> detect_anomaly(restaurant_id, alpha<span class="op">=</span><span class="fl">0.05</span>, test_size<span class="op">=</span><span class="dv">10</span>):</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> volume.loc[volume[<span class="st">"restaurant_id"</span>] <span class="op">==</span> restaurant_id, <span class="st">"volume"</span>].head(<span class="dv">220</span>)</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>    train, test <span class="op">=</span> data.iloc[:<span class="op">-</span>test_size], data.iloc[<span class="op">-</span>test_size:]</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> pm.auto_arima(train.to_numpy())</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>    pred, confint <span class="op">=</span> model.predict(test_size, return_conf_int<span class="op">=</span><span class="va">True</span>, alpha<span class="op">=</span>alpha)</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>    display(model.summary())</span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">5</span>))</span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>    x0 <span class="op">=</span> np.arange(data.shape[<span class="dv">0</span>])</span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>    plt.plot(x0, data, alpha<span class="op">=</span><span class="fl">0.7</span>, label<span class="op">=</span><span class="st">"actual volume"</span>)</span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a>    plt.scatter(x0[<span class="op">-</span>test_size:], pred, marker<span class="op">=</span><span class="st">"x"</span>, label<span class="op">=</span><span class="st">"predicted volume"</span>)</span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a>    plt.fill_between(</span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a>        x0[<span class="op">-</span>test_size:],</span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a>        confint[:, <span class="dv">0</span>],</span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a>        confint[:, <span class="dv">1</span>],</span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a>        alpha<span class="op">=</span><span class="fl">0.1</span>,</span>
<span id="cb68-19"><a href="#cb68-19" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span><span class="st">"b"</span>,</span>
<span id="cb68-20"><a href="#cb68-20" aria-hidden="true" tabindex="-1"></a>        label<span class="op">=</span><span class="st">"confidence interval"</span>,</span>
<span id="cb68-21"><a href="#cb68-21" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb68-22"><a href="#cb68-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-23"><a href="#cb68-23" aria-hidden="true" tabindex="-1"></a>    anomaly <span class="op">=</span> (test <span class="op">&lt;</span> confint[:, <span class="dv">0</span>]) <span class="op">|</span> (test <span class="op">&gt;</span> confint[:, <span class="dv">1</span>])</span>
<span id="cb68-24"><a href="#cb68-24" aria-hidden="true" tabindex="-1"></a>    plt.scatter(</span>
<span id="cb68-25"><a href="#cb68-25" aria-hidden="true" tabindex="-1"></a>        x0[<span class="op">-</span>test_size:][anomaly], test[anomaly], marker<span class="op">=</span><span class="st">"x"</span>, color<span class="op">=</span><span class="st">"r"</span>, label<span class="op">=</span><span class="st">"anomaly"</span></span>
<span id="cb68-26"><a href="#cb68-26" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb68-27"><a href="#cb68-27" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">"Volume"</span>)</span>
<span id="cb68-28"><a href="#cb68-28" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">"Day"</span>)</span>
<span id="cb68-29"><a href="#cb68-29" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">"Restaurant Order Volume"</span>)</span>
<span id="cb68-30"><a href="#cb68-30" aria-hidden="true" tabindex="-1"></a>    plt.legend()</span>
<span id="cb68-31"><a href="#cb68-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-32"><a href="#cb68-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-33"><a href="#cb68-33" aria-hidden="true" tabindex="-1"></a>detect_anomaly(<span class="dv">39</span>, test_size<span class="op">=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<table class="simpletable table table-sm table-striped small" data-quarto-postprocess="true">
<caption>SARIMAX Results</caption>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Dep. Variable:</td>
<td>y</td>
<td data-quarto-table-cell-role="th">No. Observations:</td>
<td>210</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Model:</td>
<td>SARIMAX(0, 1, 1)</td>
<td data-quarto-table-cell-role="th">Log Likelihood</td>
<td>-612.368</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Date:</td>
<td>Thu, 08 Feb 2024</td>
<td data-quarto-table-cell-role="th">AIC</td>
<td>1228.736</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Time:</td>
<td>15:22:36</td>
<td data-quarto-table-cell-role="th">BIC</td>
<td>1235.421</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Sample:</td>
<td>0</td>
<td data-quarto-table-cell-role="th">HQIC</td>
<td>1231.439</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th"></td>
<td>- 210</td>
<td data-quarto-table-cell-role="th"></td>
<td></td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Covariance Type:</td>
<td>opg</td>
<td data-quarto-table-cell-role="th"></td>
<td></td>
</tr>
</tbody>
</table>
<table class="simpletable table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="odd">
<td></td>
<td data-quarto-table-cell-role="th">coef</td>
<td data-quarto-table-cell-role="th">std err</td>
<td data-quarto-table-cell-role="th">z</td>
<td data-quarto-table-cell-role="th">P&gt;|z|</td>
<td data-quarto-table-cell-role="th">[0.025</td>
<td data-quarto-table-cell-role="th">0.975]</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">ma.L1</td>
<td>-0.8311</td>
<td>0.038</td>
<td>-21.741</td>
<td>0.000</td>
<td>-0.906</td>
<td>-0.756</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">sigma2</td>
<td>20.4197</td>
<td>1.894</td>
<td>10.782</td>
<td>0.000</td>
<td>16.708</td>
<td>24.132</td>
</tr>
</tbody>
</table>
<table class="simpletable table table-sm table-striped small" data-quarto-postprocess="true">
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Ljung-Box (L1) (Q):</td>
<td>0.17</td>
<td data-quarto-table-cell-role="th">Jarque-Bera (JB):</td>
<td>1.91</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Prob(Q):</td>
<td>0.68</td>
<td data-quarto-table-cell-role="th">Prob(JB):</td>
<td>0.38</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Heteroskedasticity (H):</td>
<td>2.29</td>
<td data-quarto-table-cell-role="th">Skew:</td>
<td>-0.18</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Prob(H) (two-sided):</td>
<td>0.00</td>
<td data-quarto-table-cell-role="th">Kurtosis:</td>
<td>3.29</td>
</tr>
</tbody>
</table>
<br><br>Warnings:<br>[1] Covariance matrix calculated using the outer product of gradients (complex-step).
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/cell-50-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>